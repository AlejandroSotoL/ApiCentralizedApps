@model CentralizedApps.Models.Dtos.CourseWebDto
@{
    ViewData["Title"] = "Formulario de cursos";
    Layout = "Layout";
}
@if (TempData["Message"] != null)
{
    <div id="tempMessage"
        class="alert @(TempData["MessageType"]?.ToString() == "success" ? "alert-success" : "alert-error")">
        @TempData["Message"]
    </div>
}

<div class="card bg-base-200 rounded-box p-0 md:p-6">
            <h1 class="font-bold text-3xl text-center mb-6">Cursos</h1>
            <div class="card bg-base-200 rounded-box grid grid-cols-1 md:grid-rows-1 p-2 gap-y-6">
                
            

                    <div class="card bg-base-300 grid p-6 ">
            <h2 class="font-bold text-2xl text-center mb-6">Crear Curso</h2>
                <form asp-action="createCourse"  asp-controller="Municipality" method="post">
                        <div class=" grid md:grid-cols-2 gap-4 ">
                        <fieldset class="fieldset w-full ">
                    <legend class="fieldset-legend">Seleccionar Municipio existente</legend>
                    <select  name="MunicipalityId" class="select w-full" required>
                        <option disabled selected value="">Municipios</option>
                        @foreach (var municipality in Model?.municipalities ?? new List<Municipality>())
                        {
                            <option value="@municipality.Id">@municipality.Name</option>
                        }
                    </select>
                </fieldset>
                            <fieldset class="fieldset">
                            <legend class="fieldset-legend">Nombre del curso</legend>
                                <input type="text"  name="Name" class="input w-full" placeholder="Nombre del curso"  required/>
                            </fieldset>
                            <fieldset class="fieldset">
                            <legend class="fieldset-legend">Get</legend>
                                <input type="text" name="Get" class="input w-full" placeholder="Enlace API / Post" required />
                            </fieldset>
                            <fieldset class="fieldset">
                            <legend class="fieldset-legend">Post</legend>
                                <input type="text" name="Post" class="input w-full" placeholder="Enlace API / Post" required/>
                            </fieldset>
                            <div class="mt-4 flex justify-self-center">
                                <label class="flex items-center gap-6">
                                    <span>Estado</span>
                                    <input type="checkbox" name="IsActive" class="toggle toggle-success" value="true" />
                                    <input type="hidden" name="IsActive" value="false" />
                                </label>
                            </div>
                        </div>
                        <div class="w-full flex justify-end my-6">
                        <button type="submit" class="btn btn-soft btn-accent w-full md:w-1/6 justify-self-center ">Crear</button>
                        </div>
                </form>
                    </div>
                



<div class="card bg-base-300 grid p-6 ">
            
            <h2 class="font-bold text-2xl text-center mb-6">Actualizar Curso</h2>
            <form asp-action="SelectCourse" asp-controller="Municipality" method="post">
                <fieldset class="fieldset w-full md:w-1/3">
                    <legend class="fieldset-legend">Seleccionar Municipio existente</legend>
                    <select  name="id" class="select w-full" onchange="this.form.submit()" required>
                        <option disabled selected value="">Municipios</option>
                        @foreach (var municipality in Model?.municipalities ?? new List<Municipality>())
                        {
                            <option value="@municipality.Id">@municipality.Name</option>
                        }
                    </select>
                </fieldset>
            </form>
        <div class="flex flex-col items-center justify-center my-10 ">
                    <div class="avatar">
                        <div class="mask mask-squircle h-24 w-24">
                            <img 
                            src="@Model?.municipality?.IdShield?.Url" 
                            alt="escudo municipio" />
                        </div>
                    </div>
                    <div class="text-center">
                        <h1 class="font-bold text-2xl">@Model?.municipality?.Name</h1>
                        <p class="text-sm opacity-70">@Model?.municipality?.Department?.Name</p>
                    </div>
                </div>


            @foreach (var course in Model?.courses ?? new List<Course>())
            {
                
                
            

                    
                <form asp-action="updateCourse"  asp-controller="Municipality" method="post">
                        <div class=" grid md:grid-cols-2 gap-4 ">
                        <input type="hidden" name="Id" value=@course.Id>
                        <input type="hidden" name="MunicipalityId" value=@course.MunicipalityId>

                            <fieldset class="fieldset">
                            <legend class="fieldset-legend">Nombre del curso</legend>
                                <input type="text" name="Name" class="input w-full" placeholder="Nombre del curso" value=@course.Name required />
                            </fieldset>
                            <fieldset class="fieldset">
                            <legend class="fieldset-legend">Get</legend>
                                <input type="text" name="Get" class="input w-full" placeholder="Enlace API / Post" value=@course.Get required/>
                            </fieldset >
                            <fieldset class="fieldset">
                            <legend class="fieldset-legend">Post</legend>
                                <input type="text" name="Post" class="input w-full" placeholder="Enlace API / Post" value=@course.Post required />
                            </fieldset>
                            <div class="mt-4 flex justify-self-center">
                                <label class="flex items-center gap-6">
                                    <span>Estado</span>
                                    <input type="checkbox" name="IsActive" value="true"
                                        class="toggle toggle-success"
                                        @(course?.IsActive == true ? "checked" : "") />
                                </label>
                                <input type="hidden" name="IsActive" value="false" />
                            </div>

                        </div>
                        <div class="w-full flex justify-center md:justify-end my-6">
                        <button type="submit" class="btn btn-soft btn-accent w-full md:w-1/6 justify-self-center ">Guardar
                            cambios</button>
                        </div>
                </form>
                   


            }
</div>
</div>

<script>
    setTimeout(() => {
            const msg = document.getElementById("tempMessage");
            if (msg) {
                msg.style.transition = "opacity 0.5s";
                msg.style.opacity = "0";
                setTimeout(() => msg.remove(), 500);
            }
        }, 2000);
</script>