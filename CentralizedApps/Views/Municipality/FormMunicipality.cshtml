@using CentralizedApps.Models.Dtos.PrincipalsDtos
@model CentralizedApps.Models.ToAlcaldiaWeb

@{
    ViewData["Title"] = "Formulario de Municipío";
    Layout = "Layout";
}

<form asp-action="SaveAlcadia" asp-controller="Municipality" method="post" class="w-full">
    <input type="hidden" asp-for="Alcaldia.Id" />

    <div class="w-full">
        @if (TempData["Success"] != null)
        {
            <div class="alert alert-success animate-fade-in mt-4 shadow-md">
                <span>@TempData["Success"]</span>
            </div>
        }
        @if (TempData["Error"] != null)
        {
            <div class="alert alert-error animate-fade-in mt-4 shadow-md">
                <span>@TempData["Error"]</span>
            </div>
        }
    </div>

    <div class="card bg-base-100 w-full rounded-2xl p-6 shadow-xl">
        <div class="flex w-full flex-col items-center justify-center gap-3 p-6">
            <div class="avatar">
                <div class="mask mask-squircle h-24 w-24">
                    <img id="previewEscudo"
                        src="@(Model?.Alcaldia?.IdShieldNavigation?.Url ?? "https://upload.wikimedia.org/wikipedia/commons/a/a3/Image-not-found.png")"
                        alt="escudo municipio" />
                </div>
            </div>
            <div class="text-center">
                <h1 class="text-2xl font-bold">@(Model?.Alcaldia?.Name ?? "En Creación")</h1>
                <p class="text-sm opacity-70">@(Model?.Alcaldia?.Department?.Name ?? "En Creación")</p>
            </div>
        </div>

        <h2 class="mb-6 text-center text-2xl font-bold">Tienes que analizár esto.</h2>
        <p class="mb-8 text-center opacity-70">
            Antes de registrar la información del municipio, primero debes crear o seleccionar
            un <strong>Tema</strong>, un <strong>Departamento</strong> y un <strong>Banco</strong>.
        </p>

        <div class="card bg-base-300 rounded-box mb-6 p-6">
            <h3 class="mb-4 text-xl font-bold">¡Cambiar o dejar!</h3>
            <div class="grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3">

                <fieldset class="fieldset">
                    <legend class="fieldset-legend">Seleccionar tema existente</legend>
                    <select class="select w-full"
                            asp-for="Alcaldia.ThemeId"
                            asp-items="@(new SelectList(Model.Themas, "Id", "NameTheme", Model.Alcaldia.ThemeId))" required>
                        <option value="">Seleccione un tema</option>
                    </select>
                </fieldset>

                <fieldset class="fieldset">
                    <legend class="fieldset-legend">Seleccione el banco existente</legend>
                    <select class="select w-full"
                            asp-for="Alcaldia.IdBank"
                            asp-items="@(new SelectList(Model.Bancos, "Id", "NameBank", Model.Alcaldia.IdBank))" required>
                        <option value="">Seleccione el banco</option>
                    </select>
                </fieldset>

                <fieldset class="fieldset">
                    <legend class="fieldset-legend">Seleccione un escudo existente</legend>
                    <select class="select w-full"
                            asp-for="Alcaldia.IdShield"
                            asp-items="@(new SelectList(Model.Escudos, "Id", "NameOfMunicipality", Model.Alcaldia.IdShield))" required>
                        <option value="">Seleccione un escudo</option>
                    </select>
                </fieldset>

                <fieldset class="fieldset">
                    <legend class="fieldset-legend">Seleccione el Departamento</legend>
                    <select class="select w-full"
                            asp-for="Alcaldia.DepartmentId"
                            asp-items="@(new SelectList(Model.Departamentos, "Id", "Name", Model.Alcaldia.DepartmentId))" required>
                        <option value="">Seleccione un departamento</option>
                    </select>
                </fieldset>
            </div>
        </div>

        <div class="card bg-base-300 rounded-box mb-6 p-6">
            <h2 class="mb-6 text-center text-2xl font-bold">Información General</h2>
            <div class="grid grid-cols-1 gap-6 md:grid-cols-3">

                <fieldset class="fieldset">
                    <legend class="fieldset-legend">Código</legend>
                    <input asp-for="Alcaldia.EntityCode" class="input w-full" required />
                </fieldset>

                <fieldset class="fieldset">
                    <legend class="fieldset-legend">Dominio</legend>
                    <div class="flex items-center gap-2">
                        <input asp-for="Alcaldia.Domain" class="input w-full" required />
                        <a class="btn btn-primary" href="@Model?.Alcaldia.Domain" target="_blank"
                        title="Abrir dominio">Observar</a>
                    </div>
                </fieldset>

                <fieldset class="fieldset">
                    <legend class="fieldset-legend">Escudo</legend>
                    <div class="flex items-center gap-2">
                        <input type="text" class="file-input w-full"
                            name="EscudoFile"
                            onchange="previewEscudo(event)"
                            value="@(Model?.Alcaldia?.IdShieldNavigation?.Url ?? string.Empty)" required/>
                        <button type="button" class="btn btn-secondary" onclick="openEscudo()" title="Vista previa">
                            Observar
                        </button>
                    </div>
                </fieldset>

                <fieldset class="fieldset">
                    <legend class="fieldset-legend">Nombre Alcaldía</legend>
                    <input asp-for="Alcaldia.Name" class="input w-full" required />
                </fieldset>

                <fieldset class="fieldset">
                    <legend class="fieldset-legend">Usuario Fintech</legend>
                    <input asp-for="Alcaldia.UserFintech" class="input w-full" required />
                </fieldset>

                <fieldset class="fieldset">
                    <legend class="fieldset-legend">Contraseña Fintech</legend>
                    <input value="@Model.Alcaldia.PasswordFintech" name="Alcaldia.PasswordFintech" type="text" class="input w-full" required />
                </fieldset>

                <fieldset class="fieldset col-span-3">
                    <legend class="fieldset-legend">Política de Privacidad</legend>
                    <textarea asp-for="Alcaldia.DataPrivacy" class="textarea w-full" required></textarea>
                </fieldset>

                <fieldset class="fieldset col-span-3">
                    <legend class="fieldset-legend">Términos y Condiciones</legend>
                    <textarea asp-for="Alcaldia.DataProcessingPrivacy" class="textarea w-full" required></textarea>
                </fieldset>
            </div>
        </div>

        @if (Model?.Alcaldia?.Id > 0)
        {
            <button type="submit" class="btn btn-success w-max">Guardar cambios</button>
        }
        else
        {
            <button type="submit" class="btn btn-success w-max">Crear</button>
        }
    </div>
</form>

<script>
    function previewEscudo(event) {
        const reader = new FileReader();
        reader.onload = function () {
            document.getElementById('previewEscudo').src = reader.result;
        };
        reader.readAsDataURL(event.target.files[0]);
    }

    function openEscudo() {
        const src = document.getElementById('previewEscudo').src;
        if (src) window.open(src, '_blank');
    }
</script>
